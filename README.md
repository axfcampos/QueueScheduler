Scheduler independent implementation.

To be merged with Omid
